<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form to Discord Webhook</title>
    <style>
        /* Simple CSS for styling the form */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }

        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #218838;
        }

        #login-button {
            margin-top: 20px;
            background-color: #007bff;
        }

        #analytics-container {
            display: none;
            margin-top: 20px;
        }
    </style>

    <!-- Include the PlayFab SDK -->
    <script src="https://download.playfab.com/PlayFabClientApi.js"></script>
</head>
<body>

    <div class="form-container">
        <h2>Simple Form</h2>
        <form id="simpleForm">
            <div class="input-group">
                <label for="name">What's your in-game name (and user ID)?</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="input-group">
                <label for="feeling">WHAT CODE ARE YOU IN</label>
                <input type="text" id="feeling" name="feeling" required>
            </div>
            <button type="submit">Submit</button>
        </form>

        <button id="login-button">Login to View Analytics</button>

        <div id="analytics-container">
            <h3>Game Analytics</h3>
            <pre id="analytics-data"></pre>
        </div>
    </div>

    <script>
        // Your PlayFab Title ID
        const titleId = "1A5F0"; // Updated PlayFab Title ID

        // Handle form submission to Discord webhook
        document.getElementById("simpleForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevents form from refreshing the page

            const name = document.getElementById("name").value;
            const feeling = document.getElementById("feeling").value;

            // Your Discord Webhook URL
            const webhookURL = "https://discord.com/api/webhooks/1286746455205351506/RltMXTGqt88bcWEok5q3Ukk6eZaeaDvSJ34mvyREo83NXT4WmH3vuRTl1nPn7uJepLO8";

            // Prepare the embedded message payload
            const payload = {
                content: "<@&1286811533925683252>", // This pings the role
                embeds: [
                    {
                        title: "New Form Submission",
                        description: "A user has submitted the form.",
                        color: 0x28a745, // Green color
                        fields: [
                            {
                                name: "In-game Name and User ID",
                                value: name,
                                inline: false
                            },
                            {
                                name: "Code",
                                value: feeling,
                                inline: false
                            }
                        ],
                        footer: {
                            text: "Form Submission Bot",
                        },
                        timestamp: new Date().toISOString()
                    }
                ]
            };

            // Send a POST request to the webhook
            fetch(webhookURL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (response.ok) {
                    alert("Form submitted and sent to Discord!");
                } else {
                    alert("There was an issue with sending the data.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("Error sending data.");
            });
        });

        function fetchAnalyticsData(playFabId) {
    const request = {
        PlayFabId: playFabId
    };

    PlayFabClientSDK.GetPlayerStatistics(request, function(result, error) {
        if (result && result.data && result.data.Statistics.length > 0) {
            console.log("Player stats fetched:", result);
            document.getElementById("analytics-data").textContent = JSON.stringify(result.data.Statistics, null, 2);
        } else if (result && result.data && result.data.Statistics.length === 0) {
            document.getElementById("analytics-data").textContent = "No statistics available for this player.";
        } else {
            console.error("Error fetching player stats:", error);
            document.getElementById("analytics-data").textContent = "Error fetching analytics data.";
        }
    });
}
document.getElementById("login-button").addEventListener("click", function() {
    const playFabId = prompt("Enter your PlayFab ID:");

    fetch(`http://localhost:3000/fetchPlayerStatistics/${playFabId}`)
        .then(response => response.json())
        .then(data => {
            if (data && Object.keys(data).length > 0) {
                document.getElementById("analytics-container").style.display = "block";
                document.getElementById("analytics-data").textContent = JSON.stringify(data, null, 2);
            } else {
                document.getElementById("analytics-data").textContent = "No data found for this player.";
            }
        })
        .catch(error => {
            document.getElementById("analytics-data").textContent = "Error fetching analytics data.";
            console.error("Error:", error);
        });
});

       
        // Handle PlayFab login and analytics display
        document.getElementById("login-button").addEventListener("click", function() {
            const loginRequest = {
                TitleId: titleId,
                CustomId: "user_custom_id_" + Math.random().toString(36).substr(2, 9), // For anonymous login
                CreateAccount: true
            };

            // Call PlayFab's LoginWithCustomID API
            PlayFabClientSDK.LoginWithCustomID(loginRequest, function(result, error) {
                if (result) {
                    console.log("Logged in successfully to PlayFab:", result);
                    document.getElementById("analytics-container").style.display = "block";
                    fetchAnalyticsData(result.data.PlayFabId); // Fetch and display analytics
                } else {
                    console.error("Login error:", error);
                    alert("Login failed! Please try again.");
                }
            });
        });

        // Fetch analytics data for the logged-in user
        function fetchAnalyticsData(playFabId) {
            const request = {
                PlayFabId: playFabId
            };

            PlayFabClientSDK.GetPlayerStatistics(request, function(result, error) {
                if (result) {
                    console.log("Player stats fetched:", result);
                    document.getElementById("analytics-data").textContent = JSON.stringify(result.data.Statistics, null, 2);
                } else {
                    console.error("Error fetching player stats:", error);
                    document.getElementById("analytics-data").textContent = "Error fetching analytics data.";
                }
            });
        }

        document.getElementById("login-button").addEventListener("click", function() {
    const playFabId = prompt("Enter your PlayFab ID:");

    fetch(`http://localhost:3000/fetchPlayerStatistics/${playFabId}`)
        .then(response => response.json())
        .then(data => {
            if (data && Object.keys(data).length > 0) {
                document.getElementById("analytics-container").style.display = "block";
                document.getElementById("analytics-data").textContent = JSON.stringify(data, null, 2);
            } else {
                document.getElementById("analytics-data").textContent = "No data found for this player.";
            }
        })
        .catch(error => {
            document.getElementById("analytics-data").textContent = "Error fetching analytics data.";
            console.error("Error:", error);
        });
});

    
    
    </script>
</body>
</html>
